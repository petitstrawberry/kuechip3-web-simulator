<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>kuesim web interface</title>
  <script src="processing-1.4.8.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <link href="kuesim.css" type="text/css" rel="stylesheet"/>
  <link href="kueasm.css" type="text/css" rel="stylesheet"/> <!-- TODO: kuesim.css と統合するか検討 -->
</head>
<body>
  <!-- interface -->
  <div id="interface">
    <div id="buttons">
      <button id="btn_exec_phase">1 phase</button>
      <button id="btn_exec_inst">1 inst</button>
      <!-- <button onclick="execAll();">all</button> -->
      <button id="btn_start_execution">start</button>
      <button id="btn_stop_execution">stop</button>
      <!-- <button onclick="setMem();">set memory</button> -->
      <input id="inst_interval" value="1"><span class="unit">msec</span>
      <input id="inst_accel" value="100"><span class="unit">inst</span>

      <!-- BEGIN for debug -->
      <span style="margin-right: 4em"></span>
      <select onkeypress="UpdateSampleId(event.keyCode);" id="program_id" value="4.1">
        <option value="4.1">[1] 1 から N までの和</option>
        <option value="4.2">[2] 3.2 多倍長の加算</option>
        <option value="4.3">[3] ユークリッドの互除法による最大公約数</option>
        <option value="4.4">[4] バブルソートによる整列</option>
        <option value="4.5">[5] CRC の計算</option>
        <option value="4.6">[6] 符号無し 1 バイトの乗算</option>
        <option value="4.7">[7] 符号無し 16 バイトの乗算</option>
        <option value="4.8">[8] 符号無し 2 バイトの除算</option>
        <option value="4.9">[9] マーチングによるメモリテスト</option>
        <option value="4.10">[10] サブルーチンコールを用いた階乗計算</option>
      </select>
      <button onclick="SetSampleProgram();">set sample</button>
      <!-- END for debug -->

      <button id="btn_simulator_reset">reset</button>
    </div>

    <div id="state-disp">
      <div id="regs-area" class="panel">
        <div class="panel-header">Phase</div>
        <div> <label><p>phase       </p><input id="Phase"        class="reg" placeholder="0"      value="0">      </label> </div>
        <div class="panel-header">Registers</div>
        <div> <label><p>PC          </p><input id="PC"           class="reg" placeholder="0x0000" value="0x0000"> </label> </div>
        <div> <label><p>IR          </p><input id="IR"           class="reg" placeholder="0x00"   value="0x00">   </label> </div>
        <div> <label><p>SP          </p><input id="SP"           class="reg" placeholder="0x0000" value="0x0000"> </label> </div>
        <div> <label><p>ACC         </p><input id="ACC"          class="reg" placeholder="0x0000" value="0x0000"> </label> </div>
        <div> <label><p>IX          </p><input id="IX"           class="reg" placeholder="0x0000" value="0x0000"> </label> </div>
        <div> <label><p>MAR         </p><input id="MAR"          class="reg" placeholder="0x0000" value="0x0000"> </label> </div>
        <div> <label><p>CF          </p><input id="CF"           class="reg" placeholder="0"      value="0">      </label> </div>
        <div> <label><p>VF          </p><input id="VF"           class="reg" placeholder="0"      value="0">      </label> </div>
        <div> <label><p>NF          </p><input id="NF"           class="reg" placeholder="0"      value="0">      </label> </div>
        <div> <label><p>ZF          </p><input id="ZF"           class="reg" placeholder="0"      value="0">      </label> </div>
        <div> <label><p>IBUF        </p><input id="IBUF"         class="reg" placeholder="0x00"   value="0x00">   </label> </div>
        <div> <label><p>OBUF        </p><input id="OBUF"         class="reg" placeholder="0x00"   value="0x00">   </label> </div>
        <div> <label><p>IBUF_RE     </p><input id="IBUF_RE"      class="reg" placeholder="0"      value="0">      </label> </div>
        <div> <label><p>OBUF_WE     </p><input id="OBUF_WE"      class="reg" placeholder="0"      value="0">      </label> </div>
        <div> <label><p>IBUF_FLG_CLR</p><input id="IBUF_FLG_CLR" class="reg" placeholder="0"      value="0">      </label> </div>
      </div>

      <div id="inst-area" class="panel">
        <div class="panel-header" style="display: flex; justify-content: space-between;">
          <p style="margin: 0">Instructions</p>
          <div style="height: 100%">
            <button id="btn_assemble">assemble</button>
            <button id="btn_set_memory">set memory</button>
          </div>
        </div>
        <textarea id="inst" placeholder="初期メモリデータを入力">
                 # PROG:   EQU  0
                 # CA:     EQU  PROG
0000: 00C0       #         EOR  ACC, ACC
0002: 006A 0056  #         LD   IX,  TEST
0006: 0076 0000  # LP0:    ST   ACC, [IX]
000A: 00BA 0002  #         ADD  IX,  2
000E: 00FA 0000  #         CMP  IX,  PROG
0012: 0031 0006  #         BNZ       LP0
0016: 00C9       #         EOR  IX,  IX
0018: 006A 0056  # LP2:    LD   IX,  TEST
001C: 00F6 0000  # LP3:    CMP  ACC, [IX]
0020: 0031 0054  #         BNZ       ERR
0024: 00C2 8000  #         EOR  ACC, 8000H
0028: 0047       #         RLL  ACC
002A: 0076 0000  #         ST   ACC, [IX]
002E: 0039 003A  #         BZ        NX3
0032: 00F2 FFFE  #         CMP  ACC, FFFEH
0036: 0031 001C  #         BNZ       LP3
003A: 00C2 FFFE  # NX3:    EOR  ACC, FFFEH
003E: 00BA 0002  #         ADD  IX,  2
0042: 00FA 0000  #         CMP  IX,  PROG
0046: 0031 001C  #         BNZ       LP3
004A: 0010       #         OUT
004C: 00C2 FFFE  #         EOR  ACC, FFFEH
0050: 0030 0018  #         BA        LP2
0054: 000F       # ERR:    HLT  
                 # TEST:   EQU  CA

</textarea>
      </div>

      <div id="mem-area" class="panel">
        <div class="panel-header">Memory</div>
        <div id="mem" class="monospace">no memory data</div> <!-- memory dump -->
      </div>

      <div id="log-area" class="panel">
        <div class="panel-header">Log</div>
        <div id="log" class="monospace"></div>
      </div>
    </div>
    <div id="overlay-assembler" class="fullscreen-overlay">
      <div class="btn-close-overlay-wrapper">
        <div class="btn-close-overlay close"></div>
      </div>
      <div id="area-assembler-inout">
        <div id="area-input-assembly">
          <textarea id="input-assembly" placeholder="input assembly here"></textarea>
        </div>
        <div id="area-output-binary">
          <textarea id="output-binary" placeholder="output binary will be generated here"></textarea>
        </div>
      </div>
      <div id="area-assembler-buttons">
        <div class="buttons">
          <button id="btn_copy_to_clipboard">copy to clipboard</button>
          <button id="btn_copy_to_simulator">copy to simulator</button>
        </div>
      </div>
    </div>
  </div>

  <!-- <canvas id="kuesim" data-processing-sources="test.pde"></canvas> -->
  <canvas id="kuesim" style="display: none;" data-processing-sources="ALU.pde input.pde InstBase.pde InstFactory.pde InstIn.pde InstNop.pde InstRcf.pde InstShift.pde InstSt.pde KueState.pde RtCode.pde textarea.pde Hex.pde InstAlu.pde InstBcc.pde InstHlt.pde InstLd.pde InstOut.pde InstScf.pde InstSp.pde KueSim.pde pos.pde simulator.pde KueIo.pde"></canvas>

  <script src="kuesim.js"></script>
  <script src="sample-prog.js"></script> <!-- for development -->
  <script src="kueasm-ui.js"></script>
</body>
</html>
